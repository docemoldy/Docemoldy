<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doce Moldy | Loja Oficial</title>
    <link rel="icon" type="image/png" href="icon.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #8B5CF6; --primary-dark: #7C3AED;
            --accent: #FDE68A; --bg-body: #F3F4F6;
            --white: #FFFFFF; --text-dark: #1F2937;
            --text-gray: #6B7280; --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background-color: var(--bg-body); color: var(--text-dark); padding-top: 100px; }
        a { text-decoration: none; color: inherit; transition: 0.2s; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }
        button { cursor: pointer; border: none; font-family: inherit; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* HEADER */
        .header-fixed { position: fixed; top: 0; left: 0; width: 100%; background: var(--white); z-index: 1000; box-shadow: var(--shadow); }
        .top-bar { background: var(--text-dark); color: white; text-align: center; font-size: 0.8rem; padding: 6px 0; font-weight: 700; }
        .nav-bar { padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .logo img { height: 40px; }
        .menu-icons { display: flex; gap: 20px; color: var(--text-gray); }
        .menu-icons a { display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; font-weight: 600; }
        .menu-icons i { font-size: 1.4rem; margin-bottom: 2px; color: var(--text-dark); }
        .menu-icons a:hover i { color: var(--primary); }

        /* HERO */
        .hero { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 40px 0; margin-bottom: 40px; border-radius: 0 0 30px 30px; text-align: center; }
        .hero h1 { font-size: 2.2rem; margin-bottom: 10px; }
        .hero p { opacity: 0.9; margin-bottom: 20px; font-size: 1.1rem; }
        .btn-hero { background: var(--accent); color: var(--text-dark); padding: 10px 30px; border-radius: 50px; font-weight: 800; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* CATEGORIAS */
        .cat-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 40px; justify-content: center; }
        .cat-pill { background: var(--white); padding: 10px 20px; border-radius: 50px; font-weight: 700; color: var(--text-gray); box-shadow: var(--shadow); white-space: nowrap; border: 2px solid transparent; display: flex; align-items: center; gap: 8px; }
        .cat-pill:hover { border-color: var(--primary); color: var(--primary); }
        .cat-pill i { color: var(--primary); }

        /* VITRINES */
        .section-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: var(--text-dark); }
        .section-title::before { content: ''; width: 6px; height: 25px; background: var(--primary); border-radius: 4px; }
        .products-grid { display: flex; gap: 20px; overflow-x: auto; padding: 10px 5px 30px 5px; min-height: 350px; }
        
        /* CARD */
        .product-card { background: var(--white); min-width: 240px; max-width: 240px; border-radius: var(--radius); padding: 15px; box-shadow: var(--shadow); position: relative; transition: 0.3s; border: 1px solid transparent; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .badge-offer { position: absolute; top: 15px; left: 15px; background: var(--accent); color: var(--text-dark); font-size: 0.7rem; padding: 4px 10px; border-radius: 20px; font-weight: 800; z-index: 2;}
        .p-img-box { height: 200px; width: 100%; border-radius: 10px; background: #f9fafb; margin-bottom: 15px; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative;}
        .p-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .p-title { font-weight: 700; font-size: 1rem; margin-bottom: 5px; color: var(--text-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-price { font-size: 1.2rem; font-weight: 800; color: var(--primary); }
        .p-old { font-size: 0.85rem; text-decoration: line-through; color: #9CA3AF; margin-right: 5px; }
        .btn-add { width: 100%; background: var(--primary); color: white; padding: 10px; border-radius: 10px; font-weight: 700; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn-add:hover { background: var(--primary-dark); }

        footer { background: var(--white); padding: 40px 0; margin-top: 50px; color: var(--text-gray); text-align: center; }
        .float-whats { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #25D366; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 999; }
        @media(max-width: 768px) { .cat-scroll { justify-content: flex-start; } .hero { border-radius: 0 0 20px 20px; padding: 30px 15px; } }
    </style>
</head>
<body>

    <header class="header-fixed">
        <div class="top-bar">FRETE GR√ÅTIS ACIMA DE R$ 299,00 üöö</div>
        <div class="container nav-bar">
            <a href="index.html" class="logo">
                <img src="logo_site.png" onerror="this.style.display='none'">
                <span>DoceMoldy</span>
            </a>
            <div class="menu-icons">
                <a href="carrinho.html"><i class="fa-solid fa-cart-shopping"></i> Carrinho</a>
                <a href="conta.html"><i class="fa-regular fa-user"></i> Login</a>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Sua Confeitaria Profissional ‚ú®</h1>
            <p>Os melhores cortadores e carimbos do mercado.</p>
            <a href="#sec-carimbos" class="btn-hero">Ver Cat√°logo</a>
        </div>
    </section>

    <div class="container" id="vitrine">
        <!-- NAVEGA√á√ÉO R√ÅPIDA -->
        <div class="cat-scroll">
            <a href="#sec-carimbos" class="cat-pill"><i class="fa-solid fa-cookie"></i> Carimbos Biscoito</a>
            <a href="#sec-doces" class="cat-pill"><i class="fa-solid fa-candy-cane"></i> Carimbinho Doces</a>
            <a href="#sec-modeladores" class="cat-pill"><i class="fa-solid fa-shapes"></i> Modeladores</a>
            <a href="#sec-outros" class="cat-pill"><i class="fa-solid fa-star"></i> Outros</a>
        </div>

        <!-- SE√á√ÉO 1: Carimbos de Biscoito -->
        <div class="section-title">üç™ Carimbos de Biscoito</div>
        <div class="products-grid" id="sec-carimbos">
            <p style="padding:20px; color:#999;">Carregando...</p>
        </div>

        <!-- SE√á√ÉO 2: Carimbinhos doces -->
        <div class="section-title">üç¨ Carimbinho de Doces</div>
        <div class="products-grid" id="sec-doces">
            <p style="padding:20px; color:#999;">Carregando...</p>
        </div>

        <!-- SE√á√ÉO 3: Modeladores -->
        <div class="section-title">‚ú® Modeladores</div>
        <div class="products-grid" id="sec-modeladores">
            <p style="padding:20px; color:#999;">Carregando...</p>
        </div>

        <!-- SE√á√ÉO 4: Outros -->
        <div class="section-title">‚≠ê Outros</div>
        <div class="products-grid" id="sec-outros">
            <p style="padding:20px; color:#999;">Carregando...</p>
        </div>
    </div>

    <footer>
        <div class="container">
            <p style="margin-bottom: 10px;">&copy; 2024 Doce Moldy. Todos os direitos reservados.</p>
            <p style="font-size: 0.9rem;"><a href="admin.html" style="color:#ccc">Acesso Administrativo</a></p>
        </div>
    </footer>

    <a href="https://wa.me/5511999999999" class="float-whats" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>

    <!-- SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyASxticHF-jnuOj2xcHm0Jc3P4U0ZOzF10",
            authDomain: "doce-moldy.firebaseapp.com",
            projectId: "doce-moldy",
            storageBucket: "doce-moldy.firebasestorage.app",
            messagingSenderId: "965940506290",
            appId: "1:965940506290:web:0067cfc07ad49399eb23ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.adicionarAoCarrinho = (nome, preco, imagem) => {
            let carrinho = JSON.parse(localStorage.getItem('carrinho_doce_moldy')) || [];
            carrinho.push({ nome, preco, imagem });
            localStorage.setItem('carrinho_doce_moldy', JSON.stringify(carrinho));
            alert(`‚úÖ ${nome} adicionado!`);
        }

        async function carregar() {
            try {
                const q = query(collection(db, "produtos"), orderBy("date", "desc"));
                const sn = await getDocs(q);
                
                ['sec-carimbos', 'sec-doces', 'sec-modeladores', 'sec-outros'].forEach(id => {
                    document.getElementById(id).innerHTML = "";
                });

                if(sn.empty) return;

                sn.forEach((doc) => {
                    const i = doc.data();
                    let targetId = 'sec-outros'; 

                    // Mapeamento EXATO (Case Sensitive)
                    if(i.category === 'Carimbos de Biscoito') targetId = 'sec-carimbos';
                    else if(i.category === 'Carimbinhos doces') targetId = 'sec-doces';
                    else if(i.category === 'modeladores') targetId = 'sec-modeladores';

                    const container = document.getElementById(targetId);
                    
                    if(container) {
                        let imgs = Array.isArray(i.images) ? i.images : [i.img];
                        let imgCapa = imgs[0] || 'https://placehold.co/300?text=Sem+Foto';
                        let imgHover = imgs.length > 1 ? imgs[1] : imgCapa;

                        // GARANTE que o caminho comece com 'Fotos/' (Mai√∫sculo)
                        if(imgCapa && imgCapa.startsWith('fotos/')) imgCapa = imgCapa.replace('fotos/', 'Fotos/');
                        if(imgHover && imgHover.startsWith('fotos/')) imgHover = imgHover.replace('fotos/', 'Fotos/');

                        const badge = i.old ? `<div class="badge-offer">OFERTA</div>` : '';
                        const oldHtml = i.old ? `<span class="p-old">${i.old}</span>` : '';

                        container.innerHTML += `
                        <div class="product-card">
                            ${badge}
                            <a href="produto.html?id=${doc.id}" class="p-img-box">
                                <img src="${imgCapa}" 
                                     onmouseover="this.src='${imgHover}'" 
                                     onmouseout="this.src='${imgCapa}'"
                                     onerror="this.src='https://placehold.co/300?text=Erro'">
                            </a>
                            <div class="p-info">
                                <a href="produto.html?id=${doc.id}" class="p-title">${i.name}</a>
                                <div class="p-price">${oldHtml} ${i.price}</div>
                                <button class="btn-add" onclick="adicionarAoCarrinho('${i.name}', '${i.price}', '${imgCapa}')">
                                    <i class="fa-solid fa-cart-plus"></i> Comprar
                                </button>
                            </div>
                        </div>`;
                    }
                });
            } catch (e) { console.error(e); }
        }
        document.addEventListener('DOMContentLoaded', carregar);
    </script>
</body>
</html>